---
title: Kubernetes-mönster med hög tillgänglighet med Azure och Azure Stack hubb
description: Lär dig hur en Kubernetes-kluster lösning ger hög tillgänglighet med Azure och Azure Stack Hub.
author: BryanLa
ms.topic: article
ms.date: 12/03/2020
ms.author: bryanla
ms.reviewer: bryanla
ms.lastreviewed: 12/03/2020
ms.openlocfilehash: 454cc0a0531882b7a8ec050a461420ce13eebcfe
ms.sourcegitcommit: df7e3e6423c3d4e8a42dae3d1acfba1d55057258
ms.translationtype: MT
ms.contentlocale: sv-SE
ms.lasthandoff: 12/09/2020
ms.locfileid: "96911795"
---
# <a name="high-availability-kubernetes-cluster-pattern"></a><span data-ttu-id="ea4a8-103">Kluster mönster för Kubernetes med hög tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="ea4a8-103">High availability Kubernetes cluster pattern</span></span>

<span data-ttu-id="ea4a8-104">Den här artikeln beskriver hur du skapar och använder en Kubernetes-baserad infrastruktur med hög tillgänglighet med hjälp av Azure Kubernetes service (AKS)-motorn på Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-104">This article describes how to architect and operate a highly available Kubernetes-based infrastructure using Azure Kubernetes Service (AKS) Engine on Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-105">Det här scenariot är vanligt för organisationer med kritiska arbets belastningar i miljöer med hög begränsning och regler.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-105">This scenario is common for organizations with critical workloads in highly restricted and regulated environments.</span></span> <span data-ttu-id="ea4a8-106">Organisationer i domäner som ekonomi, försvar och myndigheter.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-106">Organizations in domains such as finance, defense, and government.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="ea4a8-107">Kontext och problem</span><span class="sxs-lookup"><span data-stu-id="ea4a8-107">Context and problem</span></span>

<span data-ttu-id="ea4a8-108">Många organisationer utvecklar molnbaserade lösningar som utnyttjar de avancerade tjänsterna och teknikerna som Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-108">Many organizations are developing cloud-native solutions that leverage state-of-the-art services and technologies like Kubernetes.</span></span> <span data-ttu-id="ea4a8-109">Även om Azure tillhandahåller data Center i de flesta regioner i världen, finns det ibland Edge-fall och scenarier där affärs kritiska program måste köras på en bestämd plats.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-109">Although Azure provides datacenters in most regions of the world, sometimes there are edge use-cases and scenarios where business critical applications must run in a specific location.</span></span> <span data-ttu-id="ea4a8-110">Några överväganden är:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-110">Considerations include:</span></span>

- <span data-ttu-id="ea4a8-111">Plats känslighet</span><span class="sxs-lookup"><span data-stu-id="ea4a8-111">Location sensitivity</span></span>
- <span data-ttu-id="ea4a8-112">Fördröjning mellan program och lokala system</span><span class="sxs-lookup"><span data-stu-id="ea4a8-112">Latency between the application and on-premises systems</span></span>
- <span data-ttu-id="ea4a8-113">Bevarande av bandbredd</span><span class="sxs-lookup"><span data-stu-id="ea4a8-113">Bandwidth conservation</span></span>
- <span data-ttu-id="ea4a8-114">Anslutningar</span><span class="sxs-lookup"><span data-stu-id="ea4a8-114">Connectivity</span></span>
- <span data-ttu-id="ea4a8-115">Regler eller lagstadgade krav</span><span class="sxs-lookup"><span data-stu-id="ea4a8-115">Regulatory or statutory requirements</span></span>

<span data-ttu-id="ea4a8-116">Azure, i kombination med Azure Stack hubb, löser de flesta av dessa problem.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-116">Azure, in combination with Azure Stack Hub, addresses most of these concerns.</span></span> <span data-ttu-id="ea4a8-117">En rad olika alternativ, beslut och överväganden för en lyckad implementering av Kubernetes som körs på Azure Stack Hub beskrivs nedan.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-117">A broad set of options, decisions, and considerations for a successful implementation of Kubernetes running on Azure Stack Hub is described below.</span></span>

## <a name="solution"></a><span data-ttu-id="ea4a8-118">Lösning</span><span class="sxs-lookup"><span data-stu-id="ea4a8-118">Solution</span></span>

<span data-ttu-id="ea4a8-119">Det här mönstret förutsätter att vi måste hantera en strikt uppsättning begränsningar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-119">This pattern assumes that we have to deal with a strict set of constraints.</span></span> <span data-ttu-id="ea4a8-120">Programmet måste köras lokalt och alla personliga uppgifter får inte komma åt offentliga moln tjänster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-120">The application must run on-premises and all personal data must not reach public cloud services.</span></span> <span data-ttu-id="ea4a8-121">Övervakning och andra icke-PII-data kan skickas till Azure och bearbetas där.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-121">Monitoring and other non-PII data can be sent to Azure and be processed there.</span></span> <span data-ttu-id="ea4a8-122">Externa tjänster som en offentlig Container Registry eller andra kan nås, men kan filtreras via en brand vägg eller proxyserver.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-122">External services like a public Container Registry or others can be accessed but might be filtered through a firewall or proxy server.</span></span>

<span data-ttu-id="ea4a8-123">Exempel programmet som visas här (baserat på [Azure Kubernetes service workshop](/learn/modules/aks-workshop/)) är utformat för att använda Kubernetes-inbyggda lösningar när det är möjligt.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-123">The sample application shown here (based on [Azure Kubernetes Service Workshop](/learn/modules/aks-workshop/)) is designed to use Kubernetes-native solutions whenever possible.</span></span> <span data-ttu-id="ea4a8-124">Den här designen gör att du slipper låsa leverantören, i stället för att använda plattforms intern tjänster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-124">This design avoids vendor lock-in, instead of using platform-native services.</span></span> <span data-ttu-id="ea4a8-125">Som exempel använder programmet en databas server med egen värd i stället för en PaaS-tjänst eller en extern databas tjänst.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-125">As an example, the application uses a self-hosted MongoDB database backend instead of a PaaS service or external database service.</span></span>

<span data-ttu-id="ea4a8-126">[![Program mönster hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-126">[![Application Pattern Hybrid](media/pattern-highly-available-kubernetes/application-architecture.png)](media/pattern-highly-available-kubernetes/application-architecture.png#lightbox)</span></span>

<span data-ttu-id="ea4a8-127">Föregående diagram illustrerar program arkitekturen i exempel programmet som körs på Kubernetes på Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-127">The preceding diagram illustrates the application architecture of the sample application running on Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-128">Appen består av flera komponenter, inklusive:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-128">The app consists of several components, including:</span></span>

 1) <span data-ttu-id="ea4a8-129">Ett AKS Engine-baserat Kubernetes-kluster på Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-129">An AKS Engine based Kubernetes cluster on Azure Stack Hub.</span></span>
 2) <span data-ttu-id="ea4a8-130">[cert Manager](https://www.jetstack.io/cert-manager/), som innehåller en uppsättning verktyg för certifikat hantering i Kubernetes, som används för att automatiskt begära certifikat från att tillåta kryptering.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-130">[cert-manager](https://www.jetstack.io/cert-manager/), which provides a suite of tools for certificate management in Kubernetes, used to automatically request certificates from Let's Encrypt.</span></span>
 3) <span data-ttu-id="ea4a8-131">Ett Kubernetes-namnområde som innehåller program komponenterna för klient delen (klassificering – webb), API (klassificerings-API) och databas (ratings-MongoDB).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-131">A Kubernetes namespace that contains the application components for the front end (ratings-web), api (ratings-api), and database (ratings-mongodb).</span></span>
 4) <span data-ttu-id="ea4a8-132">Den ingångs kontroll enhet som dirigerar HTTP/HTTPS-trafik till slut punkter inom Kubernetes-klustret.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-132">The Ingress Controller that routes HTTP/HTTPS traffic to endpoints within the Kubernetes cluster.</span></span>

<span data-ttu-id="ea4a8-133">Exempel programmet används för att illustrera program arkitekturen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-133">The sample application is used to illustrate the application architecture.</span></span> <span data-ttu-id="ea4a8-134">Alla komponenter är exempel.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-134">All components are examples.</span></span> <span data-ttu-id="ea4a8-135">Arkitekturen innehåller bara en enda program distribution.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-135">The architecture contains only a single application deployment.</span></span> <span data-ttu-id="ea4a8-136">För att uppnå hög tillgänglighet (HA) kommer vi att köra distributionen minst två gånger på två olika Azure Stack Hubbs instanser – de kan köras antingen på samma plats eller på två (eller flera) olika platser:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-136">To achieve high availability (HA), we'll run the deployment at least twice on two different Azure Stack Hub instances - they can run either in the same location or in two (or more) different sites:</span></span>

![Infrastruktur arkitektur](media/pattern-highly-available-kubernetes/aks-azure-architecture.png)

<span data-ttu-id="ea4a8-138">Tjänster som Azure Container Registry, Azure Monitor och andra platser ligger utanför Azure Stack hubben i Azure eller lokalt.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-138">Services like Azure Container Registry, Azure Monitor, and others, are hosted outside Azure Stack Hub in Azure or on-premises.</span></span> <span data-ttu-id="ea4a8-139">Den här hybrid designen skyddar lösningen mot avbrott i en enskild Azure Stack Hub-instans.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-139">This hybrid design protects the solution against outage of a single Azure Stack Hub instance.</span></span>

## <a name="components"></a><span data-ttu-id="ea4a8-140">Komponenter</span><span class="sxs-lookup"><span data-stu-id="ea4a8-140">Components</span></span>

<span data-ttu-id="ea4a8-141">Den övergripande arkitekturen består av följande komponenter:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-141">The overall architecture consists of the following components:</span></span>

<span data-ttu-id="ea4a8-142">**Azure Stack Hub** är en förlängning av Azure som kan köra arbets belastningar i en lokal miljö genom att tillhandahålla Azure-tjänster i ditt data Center.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-142">**Azure Stack Hub** is an extension of Azure that can run workloads in an on-premises environment by providing Azure services in your datacenter.</span></span> <span data-ttu-id="ea4a8-143">Gå till [Översikt över Azure Stack Hub](/azure-stack/operator/azure-stack-overview) om du vill veta mer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-143">Go to [Azure Stack Hub overview](/azure-stack/operator/azure-stack-overview) to learn more.</span></span>

<span data-ttu-id="ea4a8-144">**Azure Kubernetes service Engine (AKS Engine)** är motorn bakom det hanterade Kubernetes Service-erbjudandet, Azure Kubernetes service (AKS), som är tillgängligt i Azure idag.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-144">**Azure Kubernetes Service Engine (AKS Engine)** is the engine behind the managed Kubernetes service offering, Azure Kubernetes Service (AKS), that is available in Azure today.</span></span> <span data-ttu-id="ea4a8-145">För Azure Stack Hub låter AKS-motorn distribuera, skala och uppgradera fullständigt aktuella, självhanterade Kubernetes-kluster med hjälp av Azure Stack Hub: s IaaS-funktioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-145">For Azure Stack Hub, AKS Engine allows us to deploy, scale, and upgrade fully featured, self-managed Kubernetes clusters using Azure Stack Hub's IaaS capabilities.</span></span> <span data-ttu-id="ea4a8-146">Gå till [AKS Engine-översikten](https://github.com/Azure/aks-engine) om du vill veta mer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-146">Go to [AKS Engine Overview](https://github.com/Azure/aks-engine) to learn more.</span></span>

<span data-ttu-id="ea4a8-147">Gå till [kända problem och begränsningar](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) för att lära dig mer om skillnaderna mellan AKS-motorn på Azure och AKS-motorn på Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-147">Go to [Known Issues and Limitations](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#known-issues-and-limitations) to learn more about the differences between AKS Engine on Azure and AKS Engine on Azure Stack Hub.</span></span>

<span data-ttu-id="ea4a8-148">**Azure Virtual Network (VNet)** används för att tillhandahålla nätverks infrastrukturen på varje Azure Stack hubb för de Virtual Machines (VM) som är värd för Kubernetes-kluster infrastrukturen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-148">**Azure Virtual Network (VNet)** is used to provide the network infrastructure on each Azure Stack Hub for the Virtual Machines (VMs) hosting the Kubernetes cluster infrastructure.</span></span>

<span data-ttu-id="ea4a8-149">**Azure Load Balancer** används för Kubernetes API-slutpunkten och Nginx ingångs kontroll.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-149">**Azure Load Balancer** is used for the Kubernetes API Endpoint and the Nginx Ingress Controller.</span></span> <span data-ttu-id="ea4a8-150">Belastningsutjämnaren dirigerar externa (till exempel Internet) trafik till noder och virtuella datorer som erbjuder en speciell tjänst.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-150">The load balancer routes external (for example, Internet) traffic to nodes and VMs offering a specific service.</span></span>

<span data-ttu-id="ea4a8-151">**Azure Container Registry (ACR)** används för att lagra privata Docker-avbildningar och Helm-diagram, som distribueras till klustret.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-151">**Azure Container Registry (ACR)** is used to store private Docker images and Helm charts, which are deployed to the cluster.</span></span> <span data-ttu-id="ea4a8-152">AKS-motorn kan autentiseras med Container Registry med hjälp av en Azure AD-identitet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-152">AKS Engine can authenticate with the Container Registry using an Azure AD identity.</span></span> <span data-ttu-id="ea4a8-153">Kubernetes kräver inte ACR.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-153">Kubernetes doesn't require ACR.</span></span> <span data-ttu-id="ea4a8-154">Du kan använda andra behållar register, till exempel Docker Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-154">You can use other container registries, such as Docker Hub.</span></span>

<span data-ttu-id="ea4a8-155">**Azure databaser** är en uppsättning versions kontroll verktyg som du kan använda för att hantera din kod.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-155">**Azure Repos** is a set of version control tools that you can use to manage your code.</span></span> <span data-ttu-id="ea4a8-156">Du kan också använda GitHub eller andra git-baserade databaser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-156">You can also use GitHub or other git-based repositories.</span></span> <span data-ttu-id="ea4a8-157">Gå till [Översikt över Azure databaser](/azure/devops/repos/get-started/what-is-repos) om du vill veta mer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-157">Go to [Azure Repos Overview](/azure/devops/repos/get-started/what-is-repos) to learn more.</span></span>

<span data-ttu-id="ea4a8-158">**Azure-pipeliner** ingår i Azure DevOps Services och kör automatiserade byggen, tester och distributioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-158">**Azure Pipelines** is part of Azure DevOps Services and runs automated builds, tests, and deployments.</span></span> <span data-ttu-id="ea4a8-159">Du kan också använda tredjeparts CI/CD-lösningar som Jenkins.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-159">You can also use third-party CI/CD solutions such as Jenkins.</span></span> <span data-ttu-id="ea4a8-160">Gå till [Översikt över Azure pipeline](/azure/devops/pipelines/get-started/what-is-azure-pipelines) för mer information.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-160">Go to [Azure Pipeline Overview](/azure/devops/pipelines/get-started/what-is-azure-pipelines) to learn more.</span></span>

<span data-ttu-id="ea4a8-161">**Azure Monitor** samlar in och lagrar mått och loggar, inklusive plattforms mått för Azure-tjänsterna i lösningen och programtelemetri.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-161">**Azure Monitor** collects and stores metrics and logs, including platform metrics for the Azure services in the solution and application telemetry.</span></span> <span data-ttu-id="ea4a8-162">Använd dessa data för att övervaka programmet, konfigurera aviseringar och instrument paneler och utföra rotor Saks analyser av fel.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-162">Use this data to monitor the application, set up alerts and dashboards, and perform root cause analysis of failures.</span></span> <span data-ttu-id="ea4a8-163">Azure Monitor integreras med Kubernetes för att samla in mått från kontrollanter, noder och behållare, samt behållar loggar och Master Node-loggar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-163">Azure Monitor integrates with Kubernetes to collect metrics from controllers, nodes, and containers, as well as container logs and master node logs.</span></span> <span data-ttu-id="ea4a8-164">Gå till [Azure Monitor översikt](/azure/azure-monitor/overview) för mer information.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-164">Go to [Azure Monitor Overview](/azure/azure-monitor/overview) to learn more.</span></span>

<span data-ttu-id="ea4a8-165">**Azure Traffic Manager** är en DNS-baserad trafikbelastnings utjämning som gör att du kan distribuera trafik optimalt till tjänster i olika Azure-regioner eller Azure Stack Hub-distributioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-165">**Azure Traffic Manager** is a DNS-based traffic load balancer that enables you to distribute traffic optimally to services across different Azure regions or Azure Stack Hub deployments.</span></span> <span data-ttu-id="ea4a8-166">Traffic Manager ger också hög tillgänglighet och svars tider.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-166">Traffic Manager also provides high availability and responsiveness.</span></span> <span data-ttu-id="ea4a8-167">Program slut punkterna måste vara tillgängliga från utsidan.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-167">The application endpoints must be accessible from the outside.</span></span> <span data-ttu-id="ea4a8-168">Det finns även andra lokala lösningar tillgängliga.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-168">There are other on-premises solutions available as well.</span></span>

<span data-ttu-id="ea4a8-169">**Kubernetes ingress-styrenheten** exponerar http (S) vägar till tjänster i ett Kubernetes-kluster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-169">**Kubernetes Ingress Controller** exposes HTTP(S) routes to services in a Kubernetes cluster.</span></span> <span data-ttu-id="ea4a8-170">Nginx eller lämplig ingångs kontroll kan användas för detta ändamål.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-170">Nginx or any suitable ingress controller can be used for this purpose.</span></span>

<span data-ttu-id="ea4a8-171">**Helm** är en paket hanterare för Kubernetes-distribution, vilket ger ett sätt att paketera olika Kubernetes-objekt, t. ex. distributioner, tjänster, hemligheter, i ett enda "diagram".</span><span class="sxs-lookup"><span data-stu-id="ea4a8-171">**Helm** is a package manager for Kubernetes deployment, providing a way to bundle different Kubernetes objects like Deployments, Services, Secrets, into a single "chart".</span></span> <span data-ttu-id="ea4a8-172">Du kan publicera, distribuera, kontrol lera versions hantering och uppdatera ett diagram objekt.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-172">You can publish, deploy, control version management, and update a chart  object.</span></span> <span data-ttu-id="ea4a8-173">Azure Container Registry kan användas som lagrings plats för att lagra paketerade Helm-diagram.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-173">Azure Container Registry can be used as a repository to store packaged Helm Charts.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="ea4a8-174">Designöverväganden</span><span class="sxs-lookup"><span data-stu-id="ea4a8-174">Design considerations</span></span>

<span data-ttu-id="ea4a8-175">Det här mönstret följer några viktiga överväganden som beskrivs i detalj i nästa avsnitt i den här artikeln:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-175">This pattern follows a few high-level considerations explained in more detail in the next sections of this article:</span></span>

- <span data-ttu-id="ea4a8-176">Programmet använder Kubernetes-inbyggda lösningar för att undvika att leverantören låser sig.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-176">The application uses Kubernetes-native solutions, to avoid vendor lock-in.</span></span>
- <span data-ttu-id="ea4a8-177">Programmet använder en arkitektur för mikrotjänster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-177">The application uses a microservices architecture.</span></span>
- <span data-ttu-id="ea4a8-178">Azure Stack Hub behöver inte vara inkommande men tillåter utgående Internet anslutning.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-178">Azure Stack Hub doesn't need inbound but allows outbound Internet connectivity.</span></span>

<span data-ttu-id="ea4a8-179">Dessa rekommendationer gäller även för verkliga arbets belastningar och scenarier.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-179">These recommended practices will apply to real-world workloads and scenarios as well.</span></span>

## <a name="scalability-considerations"></a><span data-ttu-id="ea4a8-180">Skalbarhetsöverväganden</span><span class="sxs-lookup"><span data-stu-id="ea4a8-180">Scalability considerations</span></span>

<span data-ttu-id="ea4a8-181">Skalbarhet är viktigt för att ge användarna konsekvent, tillförlitlig och väl genomförd åtkomst till programmet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-181">Scalability is important to provide users consistent, reliable, and well-performing access to the application.</span></span>

<span data-ttu-id="ea4a8-182">Exempel scenariot omfattar skalbarhet för flera skikt i program stacken.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-182">The sample scenario covers scalability on multiple layers of the application stack.</span></span> <span data-ttu-id="ea4a8-183">Här är en översikt över de olika nivåerna:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-183">Here's a high-level overview of the different layers:</span></span>

| <span data-ttu-id="ea4a8-184">Arkitektur nivå</span><span class="sxs-lookup"><span data-stu-id="ea4a8-184">Architecture level</span></span> | <span data-ttu-id="ea4a8-185">Nätverk</span><span class="sxs-lookup"><span data-stu-id="ea4a8-185">Affects</span></span> | <span data-ttu-id="ea4a8-186">Hur gör jag?</span><span class="sxs-lookup"><span data-stu-id="ea4a8-186">How?</span></span> |
| --- | --- | ---
| <span data-ttu-id="ea4a8-187">Program</span><span class="sxs-lookup"><span data-stu-id="ea4a8-187">Application</span></span> | <span data-ttu-id="ea4a8-188">Program</span><span class="sxs-lookup"><span data-stu-id="ea4a8-188">Application</span></span> | <span data-ttu-id="ea4a8-189">Horisontell skalning baserat på antalet poddar/repliker/Container Instances \*</span><span class="sxs-lookup"><span data-stu-id="ea4a8-189">Horizontal scaling based on the number of Pods/Replicas/Container Instances\*</span></span> |
| <span data-ttu-id="ea4a8-190">Kluster</span><span class="sxs-lookup"><span data-stu-id="ea4a8-190">Cluster</span></span> | <span data-ttu-id="ea4a8-191">Kubernetes-kluster</span><span class="sxs-lookup"><span data-stu-id="ea4a8-191">Kubernetes cluster</span></span> | <span data-ttu-id="ea4a8-192">Antalet noder (mellan 1 och 50), VM-SKU-storlek och Node-pooler (AKS-motorn på Azure Stack Hub stöder för närvarande bara en pool med en nod). använda AKS-motorns skalnings kommando (manuell)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-192">Number of Nodes (between 1 and 50), VM-SKU-sizes, and Node Pools (AKS Engine on Azure Stack Hub currently supports only a single node pool); using AKS Engine's scale command (manual)</span></span> |
| <span data-ttu-id="ea4a8-193">Infrastruktur</span><span class="sxs-lookup"><span data-stu-id="ea4a8-193">Infrastructure</span></span> | <span data-ttu-id="ea4a8-194">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ea4a8-194">Azure Stack Hub</span></span> | <span data-ttu-id="ea4a8-195">Antal noder, kapacitet och skalnings enheter inom en Azure Stack hubb distribution</span><span class="sxs-lookup"><span data-stu-id="ea4a8-195">Number of nodes, capacity, and scale units within an Azure Stack Hub deployment</span></span> |

<span data-ttu-id="ea4a8-196">\* Använda Kubernetes "horisontell Pod autoskalning (HPA); automatiserad Metric-baserad skalning eller vertikal skalning genom att ändra behållar instanserna (CPU/minne).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-196">\* Using Kubernetes' Horizontal Pod Autoscaler (HPA); automated metric-based scaling or vertical scaling by sizing the container instances (cpu/memory).</span></span>

<span data-ttu-id="ea4a8-197">**Azure Stack hubb (infrastruktur nivå)**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-197">**Azure Stack Hub (infrastructure level)**</span></span>

<span data-ttu-id="ea4a8-198">Azure Stack Hub-infrastrukturen är grunden för den här implementeringen eftersom Azure Stack Hub körs på fysisk maskin vara i ett Data Center.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-198">The Azure Stack Hub infrastructure is the foundation of this implementation, because Azure Stack Hub runs on physical hardware in a datacenter.</span></span> <span data-ttu-id="ea4a8-199">När du väljer nav maskin vara måste du välja mellan CPU, minnes täthet, lagrings konfiguration och antal servrar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-199">When selecting your Hub hardware, you need to make choices for CPU, memory density, storage configuration, and number of servers.</span></span> <span data-ttu-id="ea4a8-200">Om du vill veta mer om skalbarhet för Azure Stack hubb kan du läsa följande resurser:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-200">To learn more about Azure Stack Hub's scalability, check out the following resources:</span></span>

- [<span data-ttu-id="ea4a8-201">Översikt över kapacitets planering för Azure Stack hubb</span><span class="sxs-lookup"><span data-stu-id="ea4a8-201">Capacity planning for Azure Stack Hub overview</span></span>](/azure-stack/operator/azure-stack-capacity-planning-overview)
- [<span data-ttu-id="ea4a8-202">Lägg till ytterligare noder för skalnings enhet i Azure Stack hubb</span><span class="sxs-lookup"><span data-stu-id="ea4a8-202">Add additional scale unit nodes in Azure Stack Hub</span></span>](/azure-stack/operator/azure-stack-add-scale-node)

<span data-ttu-id="ea4a8-203">**Kubernetes-kluster (kluster nivå)**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-203">**Kubernetes cluster (cluster level)**</span></span>

<span data-ttu-id="ea4a8-204">Själva Kubernetes-klustret består av och bygger på Azure (stack) IaaS-komponenter, inklusive beräknings-, lagrings-och nätverks resurser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-204">The Kubernetes cluster itself consists of, and is built on top of Azure (Stack) IaaS components including compute, storage, and network resources.</span></span> <span data-ttu-id="ea4a8-205">Kubernetes-lösningar omfattar Master-och Worker-noder, som distribueras som virtuella datorer i Azure (och Azure Stack Hub).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-205">Kubernetes solutions involve master and worker nodes, which are deployed as VMs in Azure (and Azure Stack Hub).</span></span>

- <span data-ttu-id="ea4a8-206">[Control plan-noder](/azure/aks/concepts-clusters-workloads#control-plane) (Master) tillhandahåller kärn Kubernetes-tjänster och dirigering av program arbets belastningar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-206">[Control plane nodes](/azure/aks/concepts-clusters-workloads#control-plane) (master) provide the core Kubernetes services and orchestration of application workloads.</span></span>
- <span data-ttu-id="ea4a8-207">[Worker-noder](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (Worker) kör dina arbets belastningar för program.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-207">[Worker nodes](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) (worker) run your application workloads.</span></span>

<span data-ttu-id="ea4a8-208">När du väljer VM-storlekar för den första distributionen finns det flera saker att tänka på:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-208">When selecting VM sizes for the initial deployment, there are several considerations:</span></span>  

- <span data-ttu-id="ea4a8-209">**Kostnad** – när du planerar dina arbetsnoder bör du tänka på den totala kostnaden per virtuell dator som du kommer att ådra dig.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-209">**Cost** - When planning your worker nodes, keep in mind the overall cost per VM you'll incur.</span></span> <span data-ttu-id="ea4a8-210">Om dina program arbets belastningar till exempel kräver begränsade resurser, bör du planera att distribuera mindre virtuella datorer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-210">For example, if your application workloads require limited resources, you should plan to deploy smaller sized VMs.</span></span> <span data-ttu-id="ea4a8-211">Azure Stack hubb, till exempel Azure, debiteras vanligt vis enligt en konsumtion, så det är därför viktigt att storleks änd ande virtuella datorer för Kubernetes-roller är viktiga för att optimera förbruknings kostnaderna.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-211">Azure Stack Hub, like Azure, is normally billed on a consumption basis, so appropriately sizing the VMs for Kubernetes roles is crucial to optimizing consumption costs.</span></span> 

- <span data-ttu-id="ea4a8-212">**Skalbarhet** – skalbarhet för klustret uppnås genom att skala in och ut antalet master-och Worker-noder, eller genom att lägga till ytterligare resurspooler (inte tillgängligt på Azure Stack Hub idag).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-212">**Scalability** - Scalability of the cluster is achieved by scaling in and out the number of master and worker nodes, or by adding additional node pools (not available on Azure Stack Hub today).</span></span> <span data-ttu-id="ea4a8-213">Skalning av klustret kan göras baserat på prestanda data som samlas in med hjälp av container Insights (Azure Monitor + Log Analytics).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-213">Scaling the cluster can be done based on performance data, collected using Container Insights (Azure Monitor + Log Analytics).</span></span> 

    <span data-ttu-id="ea4a8-214">Om ditt program behöver fler (eller färre) resurser kan du skala ut (eller i) dina aktuella noder vågrätt (mellan 1 och 50 noder).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-214">If your application needs more (or fewer) resources, you can scale out (or in) your current nodes horizontally (between 1 and 50 nodes).</span></span> <span data-ttu-id="ea4a8-215">Om du behöver fler än 50 noder kan du skapa ett ytterligare kluster i en separat prenumeration.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-215">If you need more than 50 nodes, you can create an additional cluster in a separate subscription.</span></span> <span data-ttu-id="ea4a8-216">Du kan inte skala upp de faktiska virtuella datorerna lodrätt till en annan VM-storlek utan att omdistribuera klustret.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-216">You can't scale up the actual VMs vertically to another VM size without redeploying the cluster.</span></span>

    <span data-ttu-id="ea4a8-217">Skalning görs manuellt med hjälp av den virtuella AKS-motorn som användes för att distribuera Kubernetes-klustret från början.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-217">Scaling is done manually using the AKS Engine helper VM that was used to deploy the Kubernetes cluster initially.</span></span> <span data-ttu-id="ea4a8-218">Mer information finns i [skala Kubernetes-kluster](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-218">For more information, see [Scaling Kubernetes clusters](https://github.com/Azure/aks-engine/blob/master/docs/topics/scale.md)</span></span>

- <span data-ttu-id="ea4a8-219">**Kvoter** – Överväg de [kvoter](/azure-stack/operator/azure-stack-quota-types) som du har konfigurerat när du planerar en AKS-distribution på Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-219">**Quotas** - Consider the [quotas](/azure-stack/operator/azure-stack-quota-types) you've configured when planning out an AKS deployment on your Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-220">Se till att varje [prenumeration](/azure-stack/operator/service-plan-offer-subscription-overview) har rätt planer och kvoterna konfigurerade.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-220">Make sure each [subscription](/azure-stack/operator/service-plan-offer-subscription-overview) has the proper plans and the quotas configured.</span></span> <span data-ttu-id="ea4a8-221">Prenumerationen måste anpassas efter mängden data bearbetning, lagring och andra tjänster som behövs för att klustren ska kunna skalas ut.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-221">The subscription will need to accommodate the amount of compute, storage, and other services needed for your clusters as they scale out.</span></span>

- <span data-ttu-id="ea4a8-222">**Program arbets belastningar** – se [begreppen kluster och arbets belastnings koncept](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) i Kubernetes Core-koncept för Azure Kubernetes service-dokument.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-222">**Application workloads** - Refer to the [Clusters and workloads concepts](/azure/aks/concepts-clusters-workloads#nodes-and-node-pools) in the Kubernetes core concepts for Azure Kubernetes Service document.</span></span> <span data-ttu-id="ea4a8-223">I den här artikeln får du hjälp med att omfånget av rätt VM-storlek baserat på programmets beräknings-och minnes behov.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-223">This article will help you scope the proper VM size based on the compute and memory needs of your application.</span></span>  

<span data-ttu-id="ea4a8-224">**Program (program nivå)**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-224">**Application (application level)**</span></span>

<span data-ttu-id="ea4a8-225">I program skiktet använder vi Kubernetes [horisontell Pod autoskalning (hPa)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-225">On the application layer, we use Kubernetes [Horizontal Pod Autoscaler (HPA)](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/).</span></span> <span data-ttu-id="ea4a8-226">HPA kan öka eller minska antalet repliker (Pod/Container Instances) i vår distribution baserat på olika mått (till exempel processor användning).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-226">HPA can increase or decrease the number of Replicas (Pod/Container Instances) in our deployment based on different metrics (like CPU utilization).</span></span>

<span data-ttu-id="ea4a8-227">Ett annat alternativ är att skala container instanser lodrätt.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-227">Another option is to scale container instances vertically.</span></span> <span data-ttu-id="ea4a8-228">Detta kan åstadkommas genom att ändra mängden CPU och minne som begärs och är tillgängliga för en bestämd distribution.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-228">This can be accomplished by changing the amount of CPU and Memory requested and available for a specific deployment.</span></span> <span data-ttu-id="ea4a8-229">Mer information finns i [Hantera resurser för behållare](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) på Kubernetes.io.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-229">See [Managing Resources for Containers](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/) on kubernetes.io to learn more.</span></span>

## <a name="networking-and-connectivity-considerations"></a><span data-ttu-id="ea4a8-230">Nätverks-och anslutnings överväganden</span><span class="sxs-lookup"><span data-stu-id="ea4a8-230">Networking and connectivity considerations</span></span>

<span data-ttu-id="ea4a8-231">Nätverk och anslutning påverkar även de tre skikt som tidigare nämnts för Kubernetes på Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-231">Networking and connectivity also affect the three layers mentioned previously for Kubernetes on Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-232">I följande tabell visas de lager och vilka tjänster de innehåller:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-232">The following table shows the layers and which services they contain:</span></span>

| <span data-ttu-id="ea4a8-233">Skikt</span><span class="sxs-lookup"><span data-stu-id="ea4a8-233">Layer</span></span> | <span data-ttu-id="ea4a8-234">Nätverk</span><span class="sxs-lookup"><span data-stu-id="ea4a8-234">Affects</span></span> | <span data-ttu-id="ea4a8-235">Vad?</span><span class="sxs-lookup"><span data-stu-id="ea4a8-235">What?</span></span> |
| --- | --- | ---
| <span data-ttu-id="ea4a8-236">Program</span><span class="sxs-lookup"><span data-stu-id="ea4a8-236">Application</span></span> | <span data-ttu-id="ea4a8-237">Program</span><span class="sxs-lookup"><span data-stu-id="ea4a8-237">Application</span></span> | <span data-ttu-id="ea4a8-238">Hur är programmet tillgängligt?</span><span class="sxs-lookup"><span data-stu-id="ea4a8-238">How is the application accessible?</span></span> <span data-ttu-id="ea4a8-239">Kommer den att exponeras för Internet?</span><span class="sxs-lookup"><span data-stu-id="ea4a8-239">Will it be exposed to the Internet?</span></span> |
| <span data-ttu-id="ea4a8-240">Kluster</span><span class="sxs-lookup"><span data-stu-id="ea4a8-240">Cluster</span></span> | <span data-ttu-id="ea4a8-241">Kubernetes-kluster</span><span class="sxs-lookup"><span data-stu-id="ea4a8-241">Kubernetes cluster</span></span> | <span data-ttu-id="ea4a8-242">Kubernetes-API, AKS Engine VM, Hämta behållar avbildningar (utgående), skicka övervaknings data och telemetri (utgående)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-242">Kubernetes API, AKS Engine VM, Pulling container images (egress), Sending monitoring data and telemetry (egress)</span></span> |
| <span data-ttu-id="ea4a8-243">Infrastruktur</span><span class="sxs-lookup"><span data-stu-id="ea4a8-243">Infrastructure</span></span> | <span data-ttu-id="ea4a8-244">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ea4a8-244">Azure Stack Hub</span></span> | <span data-ttu-id="ea4a8-245">Tillgänglighet för Azure Stack Hub Management-slutpunkter som portalen och Azure Resource Manager slut punkter.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-245">Accessibility of the Azure Stack Hub management endpoints like the portal and Azure Resource Manager endpoints.</span></span> |

<span data-ttu-id="ea4a8-246">**Program**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-246">**Application**</span></span>

<span data-ttu-id="ea4a8-247">För program lagret är den viktigaste överväganden om programmet exponeras och är tillgängligt från Internet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-247">For the application layer, the most important consideration is whether the application is exposed and accessible from the Internet.</span></span> <span data-ttu-id="ea4a8-248">Från ett Kubernetest perspektiv innebär Internet åtkomst att exponera en distributions-eller Pod med hjälp av en Kubernetes-tjänst eller en ingångs kontroll.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-248">From a Kubernetes perspective, Internet accessibility means exposing a deployment or pod using a Kubernetes Service or an Ingress Controller.</span></span>

> [!NOTE]
> <span data-ttu-id="ea4a8-249">Vi rekommenderar att du använder ingångs kort för att exponera Kubernetes-tjänster som antalet offentliga IP-adresser på Azure Stack Hub är begränsat till 5.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-249">We recommend the use of Ingress controllers to expose Kubernetes Services as the number of Frontend public IPs on Azure Stack Hub is limited to 5.</span></span> <span data-ttu-id="ea4a8-250">Den här designen begränsar också antalet Kubernetes-tjänster (med typen LoadBalancer) till 5, vilket är för litet för många distributioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-250">This design also limits the number of Kubernetes Services (with the type LoadBalancer) to 5, which will be too small for many deployments.</span></span> <span data-ttu-id="ea4a8-251">Mer information finns i [dokumentationen till AKS-motorn](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) .</span><span class="sxs-lookup"><span data-stu-id="ea4a8-251">Go to the [AKS Engine documentation](https://github.com/Azure/aks-engine/blob/master/docs/topics/azure-stack.md#limited-number-of-frontend-public-ips) to learn more.</span></span>

<span data-ttu-id="ea4a8-252">Att exponera ett program med hjälp av en offentlig IP-adress via en Load Balancer eller en ingångs kontroll är inte nessecarily att programmet nu är tillgängligt via Internet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-252">Exposing an application using a public IP via a Load Balancer or an Ingress Controller doesn't nessecarily mean that the application is now accessible via the Internet.</span></span> <span data-ttu-id="ea4a8-253">Det är möjligt att Azure Stack hubb har en offentlig IP-adress som bara är synlig i det lokala intranätet, men inte alla offentliga IP-adresser är Internet-riktade.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-253">It's possible for Azure Stack Hub to have a public IP address that is only visible on the local intranet - not all public IPs are truly Internet-facing.</span></span>

<span data-ttu-id="ea4a8-254">Föregående block avser inkommande trafik till programmet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-254">The previous block considers ingress traffic to the application.</span></span> <span data-ttu-id="ea4a8-255">Ett annat avsnitt som måste beaktas för en lyckad Kubernetes-distribution är utgående/utgående trafik.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-255">Another topic that must be considered for a successful Kubernetes deployment is outbound/egress traffic.</span></span> <span data-ttu-id="ea4a8-256">Här är några användnings fall som kräver utgående trafik:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-256">Here are a few use cases that require egress traffic:</span></span>

- <span data-ttu-id="ea4a8-257">Hämta behållar avbildningar som lagras på DockerHub eller Azure Container Registry</span><span class="sxs-lookup"><span data-stu-id="ea4a8-257">Pulling Container Images stored on DockerHub or Azure Container Registry</span></span>
- <span data-ttu-id="ea4a8-258">Hämtar Helm-diagram</span><span class="sxs-lookup"><span data-stu-id="ea4a8-258">Retrieving Helm Charts</span></span>
- <span data-ttu-id="ea4a8-259">Sändning av Application Insights data (eller andra övervaknings data)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-259">Emitting Application Insights data (or other monitoring data)</span></span>

<span data-ttu-id="ea4a8-260">Vissa företags miljöer kan kräva användning av _transparenta_ eller _icke-transparenta_ proxyservrar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-260">Some enterprise environments might require the use of _transparent_ or _non-transparent_ proxy servers.</span></span> <span data-ttu-id="ea4a8-261">Dessa servrar kräver en speciell konfiguration på olika komponenter i vårt kluster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-261">These servers require specific configuration on various components of our cluster.</span></span> <span data-ttu-id="ea4a8-262">Dokumentation om AKS-motorn innehåller olika uppgifter om hur du hanterar nätverks-proxyservrar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-262">The AKS Engine documentation contains various details on how to accommodate network proxies.</span></span> <span data-ttu-id="ea4a8-263">Mer information finns i [AKS motor and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-263">For more details, see [AKS Engine and proxy servers](https://github.com/Azure/aks-engine/blob/master/docs/topics/proxy-servers.md)</span></span>

<span data-ttu-id="ea4a8-264">Till sist måste trafiken mellan kluster ligga mellan Azure Stack Hub-instanser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-264">Lastly, cross-cluster traffic must flow between Azure Stack Hub instances.</span></span> <span data-ttu-id="ea4a8-265">Exempel distributionen består av enskilda Kubernetes-kluster som körs på enskilda Azure Stack Hubbs instanser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-265">The sample deployment consists of individual Kubernetes clusters running on individual Azure Stack Hub instances.</span></span> <span data-ttu-id="ea4a8-266">Trafik mellan dem, till exempel replikeringstrafik mellan två databaser, är "extern trafik".</span><span class="sxs-lookup"><span data-stu-id="ea4a8-266">Traffic between them, such as the replication traffic between two databases, is "external traffic".</span></span> <span data-ttu-id="ea4a8-267">Extern trafik måste dirigeras via antingen en plats-till-plats-VPN-eller Azure Stack hubb offentliga IP-adresser för att ansluta Kubernetes på två Azure Stack Hub-instanser:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-267">External traffic must be routed through either a Site-to-Site VPN or Azure Stack Hub Public IP addresses to connect Kubernetes on two Azure Stack Hub instances:</span></span>

![trafik mellan och inom kluster](media/pattern-highly-available-kubernetes/aks-inter-and-intra-cluster-traffic.png)

<span data-ttu-id="ea4a8-269">**Kluster**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-269">**Cluster**</span></span>  

<span data-ttu-id="ea4a8-270">Kubernetes-klustret behöver inte nödvändigt vis vara tillgängligt via Internet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-270">The Kubernetes cluster doesn't necessarily need to be accessible via the Internet.</span></span> <span data-ttu-id="ea4a8-271">Den relevanta delen är det Kubernetes-API som används för att köra ett kluster, till exempel med hjälp av `kubectl` .</span><span class="sxs-lookup"><span data-stu-id="ea4a8-271">The relevant part is the Kubernetes API used to operate a cluster, for example, using `kubectl`.</span></span> <span data-ttu-id="ea4a8-272">Kubernetes API-slutpunkten måste vara tillgänglig för alla som använder klustret eller distribuerar program och tjänster ovanpå dem.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-272">The Kubernetes API endpoint must be accessible to everyone who operates the cluster or deploys applications and services on top of it.</span></span> <span data-ttu-id="ea4a8-273">Det här avsnittet beskrivs mer detaljerat från en DevOps i avsnittet [distribution (CI/CD)](#deployment-cicd-considerations) nedan.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-273">This topic is covered in more detail from a DevOps-perspective in the [Deployment (CI/CD) considerations](#deployment-cicd-considerations) section below.</span></span>

<span data-ttu-id="ea4a8-274">På kluster nivå finns det också några överväganden kring utgående trafik:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-274">On the cluster level, there are also a few considerations around egress-traffic:</span></span>

- <span data-ttu-id="ea4a8-275">Uppdatering av nod (för Ubuntu)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-275">Node updates (for Ubuntu)</span></span>
- <span data-ttu-id="ea4a8-276">Övervaknings data (skickas till Azure-LogAnalytics)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-276">Monitoring data (sent to Azure LogAnalytics)</span></span>
- <span data-ttu-id="ea4a8-277">Andra agenter som kräver utgående trafik (gäller för varje distributions miljö)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-277">Other agents requiring outbound traffic (specific to each deployer's environment)</span></span>

<span data-ttu-id="ea4a8-278">Innan du distribuerar ditt Kubernetes-kluster med AKS-motorn bör du planera för den slutliga nätverks utformningen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-278">Before you deploy your Kubernetes cluster using AKS Engine, plan for the final networking design.</span></span> <span data-ttu-id="ea4a8-279">I stället för att skapa en dedikerad Virtual Network kan det vara mer effektivt att distribuera ett kluster till ett befintligt nätverk.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-279">Instead of creating a dedicated Virtual Network, it may be more efficient to deploy a cluster into an existing network.</span></span> <span data-ttu-id="ea4a8-280">Du kan till exempel utnyttja en befintlig VPN-anslutning för plats-till-plats som redan har kon figurer ATS i din Azure Stack Hub-miljö.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-280">For example, you might leverage an existing Site-to-Site VPN connection already configured in your Azure Stack Hub environment.</span></span>

<span data-ttu-id="ea4a8-281">**Infrastruktur**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-281">**Infrastructure**</span></span>  

<span data-ttu-id="ea4a8-282">Infrastruktur syftar på åtkomst till Azure Stack Hub Management-slutpunkter.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-282">Infrastructure refers to accessing the Azure Stack Hub management endpoints.</span></span> <span data-ttu-id="ea4a8-283">Slut punkter innehåller klient-och administrations portalerna och Azure Resource Manager-administratör och klient slut punkter.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-283">Endpoints include the tenant and admin portals, and the Azure Resource Manager admin and tenant endpoints.</span></span> <span data-ttu-id="ea4a8-284">De här slut punkterna krävs för att kunna använda Azure Stack Hub och dess kärn tjänster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-284">These endpoints are required to operate Azure Stack Hub and its core services.</span></span>

## <a name="data-and-storage-considerations"></a><span data-ttu-id="ea4a8-285">Överväganden för data och lagring</span><span class="sxs-lookup"><span data-stu-id="ea4a8-285">Data and storage considerations</span></span>

<span data-ttu-id="ea4a8-286">Två instanser av programmet kommer att distribueras på två enskilda Kubernetes-kluster i två Azure Stack Hubbs instanser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-286">Two instances of our application will be deployed, on two individual Kubernetes clusters, across two Azure Stack Hub instances.</span></span> <span data-ttu-id="ea4a8-287">Den här designen kräver att vi funderar på hur du ska replikera och synkronisera data mellan dem.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-287">This design will require us to consider how to replicate and synchronize data between them.</span></span>

<span data-ttu-id="ea4a8-288">Med Azure har vi den inbyggda funktionen för att replikera lagring över flera regioner och zoner i molnet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-288">With Azure, we have the built-in capability to replicate storage across multiple regions and zones within the cloud.</span></span> <span data-ttu-id="ea4a8-289">För närvarande med Azure Stack Hub finns det inga inbyggda sätt att replikera lagringen över två olika Azure Stack Hub-instanser – de utgör två oberoende moln utan att det finns något överlappande sätt att hantera dem som en uppsättning.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-289">Currently with Azure Stack Hub there are no native ways to replicate storage across two different Azure Stack Hub instances - they form two independent clouds with no overarching way to manage them as a set.</span></span> <span data-ttu-id="ea4a8-290">Genom att planera för återhämtning av program som körs i Azure Stack Hub kan du överväga detta oberoende i dina program design och distributioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-290">Planning for resiliency of applications running across Azure Stack Hub forces you to consider this independence in your application design and deployments.</span></span>

<span data-ttu-id="ea4a8-291">I de flesta fall behövs inte Storage-replikering för ett elastiskt och hög tillgängligt program som distribueras på AKS.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-291">In most cases, storage replication won't be necessary for a resilient and highly available application deployed on AKS.</span></span> <span data-ttu-id="ea4a8-292">Men du bör överväga oberoende lagring per Azure Stack Hub-instans i din program design.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-292">But you should consider independent storage per Azure Stack Hub instance in your application design.</span></span> <span data-ttu-id="ea4a8-293">Om den här designen är ett problem eller ett väg block för att distribuera lösningen på Azure Stack hubb, finns det möjliga lösningar från Microsoft-partner som tillhandahåller bilagor för lagring.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-293">If this design is a concern or road block to deploying the solution on Azure Stack Hub, there are possible solutions from Microsoft Partners that provide storage attachments.</span></span> <span data-ttu-id="ea4a8-294">Storage-bilagor tillhandahåller en lösning för lagrings replikering över flera Azure Stack hubbar och Azure.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-294">Storage attachments provide a storage replication solution across multiple Azure Stack Hubs and Azure.</span></span> <span data-ttu-id="ea4a8-295">Mer information finns i [partner lösningar](#partner-solutions).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-295">For more information, see the [Partner solutions](#partner-solutions).</span></span>

<span data-ttu-id="ea4a8-296">I vår arkitektur ansågs dessa lager vara:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-296">In our architecture, these layers were considered:</span></span>

<span data-ttu-id="ea4a8-297">**Konfiguration**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-297">**Configuration**</span></span>

<span data-ttu-id="ea4a8-298">Konfigurationen omfattar konfigurationen av Azure Stack hubb, AKS-motor och Kubernetes-klustret.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-298">Configuration includes the configuration of Azure Stack Hub, AKS Engine, and the Kubernetes cluster itself.</span></span> <span data-ttu-id="ea4a8-299">Konfigurationen bör automatiseras så mycket som möjligt och lagras som infrastruktur som kod i ett git-baserat versions kontroll system som Azure DevOps eller GitHub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-299">The configuration should be automated as much as possible, and stored as Infrastructure-as-Code in a Git-based version control system like Azure DevOps or GitHub.</span></span> <span data-ttu-id="ea4a8-300">Dessa inställningar kan inte enkelt synkroniseras över flera distributioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-300">These settings cannot easily be synchronized across multiple deployments.</span></span> <span data-ttu-id="ea4a8-301">Vi rekommenderar därför att du lagrar och tillämpar konfiguration från utsidan och använder DevOps pipeline.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-301">Therefore we recommend storing and applying configuration from the outside, and using DevOps pipeline.</span></span>

<span data-ttu-id="ea4a8-302">**Program**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-302">**Application**</span></span>

<span data-ttu-id="ea4a8-303">Programmet ska lagras i en git-baserad lagrings plats.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-303">The application should be stored in a Git-based repository.</span></span> <span data-ttu-id="ea4a8-304">När det finns en ny distribution, ändringar i programmet eller haveri beredskap, kan det enkelt distribueras med hjälp av Azure-pipeliner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-304">Whenever there's a new deployment, changes to the application, or disaster recovery, it can be easily deployed using Azure Pipelines.</span></span>

<span data-ttu-id="ea4a8-305">**Data**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-305">**Data**</span></span>

<span data-ttu-id="ea4a8-306">Data är den viktigaste övervägandeheten i de flesta program design.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-306">Data is the most important consideration in most application designs.</span></span> <span data-ttu-id="ea4a8-307">Program data måste vara synkroniserade mellan olika instanser av programmet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-307">Application data must stay in sync between the different instances of the application.</span></span> <span data-ttu-id="ea4a8-308">Data behöver också en strategi för säkerhets kopiering och haveri beredskap om det uppstår ett avbrott.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-308">Data also needs a backup and disaster recovery strategy if there's an outage.</span></span>

<span data-ttu-id="ea4a8-309">Att uppnå den här designen beror på teknik val.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-309">Achieving this design depends heavily on technology choices.</span></span> <span data-ttu-id="ea4a8-310">Här följer några exempel på lösningar för att implementera en databas med hög tillgänglighet på Azure Stack Hub:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-310">Here are some solution examples for implementing a database in a highly available fashion on Azure Stack Hub:</span></span>

- [<span data-ttu-id="ea4a8-311">Distribuera en SQL Server 2016-tillgänglighets grupp till Azure och Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="ea4a8-311">Deploy a SQL Server 2016 availability group to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-sql-ha)
- [<span data-ttu-id="ea4a8-312">Distribuera en MongoDB-lösning med hög tillgänglighet till Azure och Azure Stack hubb</span><span class="sxs-lookup"><span data-stu-id="ea4a8-312">Deploy a highly available MongoDB solution to Azure and Azure Stack Hub</span></span>](/azure-stack/hybrid/solution-deployment-guide-mongodb-ha)

<span data-ttu-id="ea4a8-313">Att tänka på när du arbetar med data på flera platser är en ännu mer komplicerad lösning för en hög tillgänglig och flexibel lösning.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-313">Considerations when working with data across multiple locations is an even more complex consideration for a highly available and resilient solution.</span></span> <span data-ttu-id="ea4a8-314">Tänk på att:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-314">Consider:</span></span>

- <span data-ttu-id="ea4a8-315">Svars tid och nätverks anslutning mellan Azure Stack hubbar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-315">Latency and network connectivity between Azure Stack Hubs.</span></span>
- <span data-ttu-id="ea4a8-316">Tillgänglighet för identiteter för tjänster och behörigheter.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-316">Availability of identities for services and permissions.</span></span> <span data-ttu-id="ea4a8-317">Varje Azure Stack Hub-instans integreras med en extern katalog.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-317">Each Azure Stack Hub instance integrates with an external directory.</span></span> <span data-ttu-id="ea4a8-318">Under distributionen väljer du antingen Azure Active Directory (Azure AD) eller Active Directory Federation Services (AD FS) (ADFS).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-318">During deployment, you choose to use either Azure Active Directory (Azure AD) or Active Directory Federation Services (ADFS).</span></span> <span data-ttu-id="ea4a8-319">Därför är det möjligt att använda en enda identitet som kan samverka med flera oberoende Azure Stack Hubbs instanser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-319">As such, there's potential to use a single identity that can interact with multiple independent Azure Stack Hub instances.</span></span>

## <a name="business-continuity-and-disaster-recovery"></a><span data-ttu-id="ea4a8-320">Affärskontinuitet och haveriberedskap</span><span class="sxs-lookup"><span data-stu-id="ea4a8-320">Business continuity and disaster recovery</span></span>

<span data-ttu-id="ea4a8-321">Verksamhets kontinuitet och haveri beredskap (BCDR) är ett viktigt avsnitt i både Azure Stack hubb och Azure.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-321">Business continuity and disaster recovery (BCDR) is an important topic in both Azure Stack Hub and Azure.</span></span> <span data-ttu-id="ea4a8-322">Den största skillnaden är att operatören måste hantera hela BCDR-processen i Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-322">The main difference is that in Azure Stack Hub, the operator must manage the whole BCDR process.</span></span> <span data-ttu-id="ea4a8-323">I Azure hanteras delar av BCDR automatiskt av Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-323">In Azure, parts of BCDR are automatically managed by Microsoft.</span></span>

<span data-ttu-id="ea4a8-324">BCDR påverkar samma områden som anges i föregående avsnitts [data och överväganden för lagring](#data-and-storage-considerations):</span><span class="sxs-lookup"><span data-stu-id="ea4a8-324">BCDR affects the same areas mentioned in the previous section [Data and storage considerations](#data-and-storage-considerations):</span></span>

- <span data-ttu-id="ea4a8-325">Infrastruktur/konfiguration</span><span class="sxs-lookup"><span data-stu-id="ea4a8-325">Infrastructure / Configuration</span></span>
- <span data-ttu-id="ea4a8-326">Tillgänglighet för program</span><span class="sxs-lookup"><span data-stu-id="ea4a8-326">Application Availability</span></span>
- <span data-ttu-id="ea4a8-327">Programdata</span><span class="sxs-lookup"><span data-stu-id="ea4a8-327">Application Data</span></span>

<span data-ttu-id="ea4a8-328">Som vi nämnt i föregående avsnitt är dessa områden ansvaret för Azure Stack Hub-operatören och kan variera mellan olika organisationer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-328">And as mentioned in the previous section, these areas are the responsibility of the Azure Stack Hub operator and can vary between organizations.</span></span> <span data-ttu-id="ea4a8-329">Planera BCDR enligt dina tillgängliga verktyg och processer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-329">Plan BCDR according to your available tools and processes.</span></span>

<span data-ttu-id="ea4a8-330">**Infrastruktur och konfiguration**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-330">**Infrastructure and configuration**</span></span>

<span data-ttu-id="ea4a8-331">I det här avsnittet beskrivs den fysiska och logiska infrastrukturen och konfigurationen av Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-331">This section covers the physical and logical infrastructure and the configuration of Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-332">Den täcker åtgärder i administratören och klientens utrymmen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-332">It covers actions in the admin and the tenant spaces.</span></span>

<span data-ttu-id="ea4a8-333">Azure Stack Hubbs operatorn (eller administratören) ansvarar för underhåll av Azure Stack Hub-instanserna.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-333">The Azure Stack Hub operator (or administrator) is responsible for maintenance of the Azure Stack Hub instances.</span></span> <span data-ttu-id="ea4a8-334">Inklusive komponenter som nätverk, lagring, identitet och andra ämnen som omfattas av den här artikeln.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-334">Including components such as the network, storage, identity, and other topics that are outside the scope of this article.</span></span> <span data-ttu-id="ea4a8-335">Mer information om de olika Azure Stack Hub-åtgärderna finns i följande resurser:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-335">To learn more about the specifics of Azure Stack Hub operations, see the following resources:</span></span>

- [<span data-ttu-id="ea4a8-336">Återställa data i Azure Stack hubb med tjänsten Infrastructure Backup</span><span class="sxs-lookup"><span data-stu-id="ea4a8-336">Recover data in Azure Stack Hub with the Infrastructure Backup Service</span></span>](/azure-stack/operator/azure-stack-backup-infrastructure-backup)
- [<span data-ttu-id="ea4a8-337">Aktivera säkerhets kopiering för Azure Stack hubb från administratörs portalen</span><span class="sxs-lookup"><span data-stu-id="ea4a8-337">Enable backup for Azure Stack Hub from the administrator portal</span></span>](/azure-stack/operator/azure-stack-backup-enable-backup-console)
- [<span data-ttu-id="ea4a8-338">Återställa från oåterkallelig dataförlust</span><span class="sxs-lookup"><span data-stu-id="ea4a8-338">Recover from catastrophic data loss</span></span>](/azure-stack/operator/azure-stack-backup-recover-data)
- [<span data-ttu-id="ea4a8-339">Metodtips för Infrastructure Backup-tjänsten</span><span class="sxs-lookup"><span data-stu-id="ea4a8-339">Infrastructure Backup Service best practices</span></span>](/azure-stack/operator/azure-stack-backup-best-practices)

<span data-ttu-id="ea4a8-340">Azure Stack Hub är den plattform och infrastruktur som Kubernetes-program kommer att distribueras till.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-340">Azure Stack Hub is the platform and fabric on which Kubernetes applications will be deployed.</span></span> <span data-ttu-id="ea4a8-341">Program ägaren för Kubernetes-programmet är en användare av Azure Stack Hub, med åtkomst som beviljats för att distribuera den program infrastruktur som krävs för lösningen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-341">The application owner for the Kubernetes application will be a user of Azure Stack Hub, with access granted to deploy the application infrastructure needed for the solution.</span></span> <span data-ttu-id="ea4a8-342">Program infrastruktur i det här fallet innebär Kubernetes-klustret, distribuerat med AKS-motorn och de omgivande tjänsterna.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-342">Application infrastructure in this case means the Kubernetes cluster, deployed using AKS Engine, and the surrounding services.</span></span> <span data-ttu-id="ea4a8-343">Dessa komponenter kommer att distribueras till Azure Stack Hub, vilket är begränsat av ett Azure Stack Hub-erbjudande.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-343">These components will be deployed into Azure Stack Hub, constrained by an Azure Stack Hub offer.</span></span> <span data-ttu-id="ea4a8-344">Se till att erbjudandet som godkänns av Kubernetes program ägare har tillräckligt med kapacitet (uttryckt i Azure Stack hubb kvoter) för att distribuera hela lösningen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-344">Make sure the offer accepted by the Kubernetes application owner has sufficient capacity (expressed in Azure Stack Hub quotas) to deploy the entire solution.</span></span> <span data-ttu-id="ea4a8-345">Som rekommenderas i föregående avsnitt bör program distributionen automatiseras med hjälp av infrastruktur som kod och distributions pipeliner som Azure DevOps Azure-pipelines.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-345">As recommended in the previous section, the application deployment should be automated using Infrastructure-as-Code and deployment pipelines like Azure DevOps Azure Pipelines.</span></span>

<span data-ttu-id="ea4a8-346">Mer information om Azure Stack Hubbs erbjudanden och kvoter finns i [Översikt över Azure Stack hubb, abonnemang, erbjudanden och prenumerationer](/azure-stack/operator/service-plan-offer-subscription-overview)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-346">For more information on Azure Stack Hub offers and quotas, see [Azure Stack Hub services, plans, offers, and subscriptions overview](/azure-stack/operator/service-plan-offer-subscription-overview)</span></span>

<span data-ttu-id="ea4a8-347">Det är viktigt att spara och lagra AKS Engine-konfigurationen på ett säkert sätt, inklusive dess utdata.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-347">It's important to securely save and store the AKS Engine configuration including its outputs.</span></span> <span data-ttu-id="ea4a8-348">De här filerna innehåller konfidentiell information som används för att komma åt Kubernetes-klustret, så den måste skyddas från att exponeras för icke-administratörer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-348">These files contain confidential information used to access the Kubernetes cluster, so it must be protected from being exposed to non-administrators.</span></span>

<span data-ttu-id="ea4a8-349">**Tillgänglighet för program**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-349">**Application availability**</span></span>

<span data-ttu-id="ea4a8-350">Programmet bör inte förlita sig på säkerhets kopieringar av en distribuerad instans.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-350">The application shouldn't rely on backups of a deployed instance.</span></span> <span data-ttu-id="ea4a8-351">Som standard praxis kan du distribuera om programmet fullständigt efter infrastruktur-som-kod mönster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-351">As a standard practice, redeploy the application completely following Infrastructure-as-Code patterns.</span></span> <span data-ttu-id="ea4a8-352">Distribuera till exempel med Azure DevOps Azure-pipelines.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-352">For example, redeploy using Azure DevOps Azure Pipelines.</span></span> <span data-ttu-id="ea4a8-353">BCDR-proceduren bör omfatta omdistribution av programmet till samma eller ett annat Kubernetes-kluster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-353">The BCDR procedure should involve the redeployment of the application to the same or another Kubernetes cluster.</span></span>

<span data-ttu-id="ea4a8-354">**Program data**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-354">**Application data**</span></span>

<span data-ttu-id="ea4a8-355">Program data är den viktigaste delen för att minimera data förlust.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-355">Application data is the critical part to minimize data loss.</span></span> <span data-ttu-id="ea4a8-356">I föregående avsnitt beskrevs tekniker för att replikera och synkronisera data mellan två (eller flera) instanser av programmet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-356">In the previous section, techniques to replicate and synchronize data between two (or more) instances of the application were described.</span></span> <span data-ttu-id="ea4a8-357">Beroende på databas infrastrukturen (MySQL, MongoDB, MSSQL eller andra) som används för att lagra data, finns det olika databas tillgänglighets-och säkerhets kopierings tekniker som du kan välja mellan.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-357">Depending on the database infrastructure (MySQL, MongoDB, MSSQL or others) used to store the data, there will be different database availability and backup techniques available to choose from.</span></span>

<span data-ttu-id="ea4a8-358">Rekommenderade metoder för att uppnå integritet är att använda antingen:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-358">The recommended ways to achieve integrity are to use either:</span></span>
- <span data-ttu-id="ea4a8-359">En inbyggd lösning för säkerhets kopiering för den specifika databasen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-359">A native backup solution for the specific database.</span></span>
- <span data-ttu-id="ea4a8-360">En säkerhets kopierings lösning som officiellt stöder säkerhets kopiering och återställning av den databas typ som används av ditt program.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-360">A backup solution that officially supports backup and recovery of the database type used by your application.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ea4a8-361">Lagra inte dina säkerhets kopierings data på samma Azure Stack Hub-instans där dina program data finns.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-361">Do not store your backup data on the same Azure Stack Hub instance where your application data resides.</span></span> <span data-ttu-id="ea4a8-362">Ett fullständigt avbrott i Azure Stack Hub-instansen skulle också äventyra dina säkerhets kopieringar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-362">A complete outage of the Azure Stack Hub instance would also compromise your backups.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="ea4a8-363">Överväganden för tillgänglighet</span><span class="sxs-lookup"><span data-stu-id="ea4a8-363">Availability considerations</span></span>

<span data-ttu-id="ea4a8-364">Kubernetes på Azure Stack Hub som distribueras via AKS-motorn är inte en hanterad tjänst.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-364">Kubernetes on Azure Stack Hub deployed via AKS Engine isn't a managed service.</span></span> <span data-ttu-id="ea4a8-365">Det är en automatiserad distribution och konfiguration av ett Kubernetes-kluster med Azure Infrastructure-as-a-Service (IaaS).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-365">It's an automated deployment and configuration of a Kubernetes cluster using Azure Infrastructure-as-a-Service (IaaS).</span></span> <span data-ttu-id="ea4a8-366">Detta ger samma tillgänglighet som den underliggande infrastrukturen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-366">As such, it provides the same availability as the underlying infrastructure.</span></span>

<span data-ttu-id="ea4a8-367">Azure Stack Hub-infrastrukturen är redan flexibelt för fel och ger funktioner som tillgänglighets uppsättningar för att distribuera komponenter över flera [fel och uppdaterings domäner](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-367">Azure Stack Hub infrastructure is already resilient to failures, and provides capabilities like Availability Sets to distribute components across multiple [fault and update domains](/azure-stack/user/azure-stack-vm-considerations#high-availability).</span></span> <span data-ttu-id="ea4a8-368">Men den underliggande tekniken (redundanskluster) medför fortfarande vissa stillestånds tider för virtuella datorer på en påverkad fysisk server, om ett maskin varu fel uppstår.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-368">But the underlying technology (failover clustering) still incurs some downtime for VMs on an impacted physical server, if there's a hardware failure.</span></span>

<span data-ttu-id="ea4a8-369">Det är en bra idé att distribuera ditt produktions Kubernetes-kluster samt arbets belastningen till två (eller flera) kluster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-369">It's a good practice to deploy your production Kubernetes cluster as well as the workload to two (or more) clusters.</span></span> <span data-ttu-id="ea4a8-370">Dessa kluster bör finnas på olika platser eller data Center, och använder tekniker som Azure Traffic Manager för att dirigera användare baserat på kluster svars tid eller baserat på geografi.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-370">These clusters should be hosted in different locations or datacenters, and use technologies like Azure Traffic Manager to route users based on cluster response time or based on geography.</span></span>

![Använda Traffic Manager för att kontrol lera trafik flöden](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager.png)

<span data-ttu-id="ea4a8-372">Kunder som har ett enda Kubernetes-kluster ansluter vanligt vis till tjänstens IP-adress eller DNS-namn för ett visst program.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-372">Customers who have a single Kubernetes cluster typically connect to the service IP or DNS name of a given application.</span></span> <span data-ttu-id="ea4a8-373">I en distribution med flera kluster bör kunderna ansluta till ett Traffic Manager DNS-namn som pekar på tjänsterna/ingressen på varje Kubernetes-kluster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-373">In a multi-cluster deployment, customers should connect to a Traffic Manager DNS name that points to the services/ingress on each Kubernetes cluster.</span></span>

![Använda Traffic Manager för att dirigera till ett lokalt kluster](media/pattern-highly-available-kubernetes/aks-azure-traffic-manager-on-premises.png)

> [!NOTE]
> <span data-ttu-id="ea4a8-375">Det här mönstret är också [bästa praxis för (hanterade) AKS-kluster i Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-375">This pattern is also a [best practice for (managed) AKS clusters in Azure](/azure/aks/operator-best-practices-multi-region#plan-for-multiregion-deployment).</span></span>

<span data-ttu-id="ea4a8-376">Kubernetes-klustret, som distribueras via AKS-motorn, bör bestå av minst tre huvudnoder och två arbetsnoder.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-376">The Kubernetes cluster itself, deployed via AKS Engine, should consist of at least three master nodes and two worker nodes.</span></span>

## <a name="identity-and-security-considerations"></a><span data-ttu-id="ea4a8-377">Identitets-och säkerhets aspekter</span><span class="sxs-lookup"><span data-stu-id="ea4a8-377">Identity and security considerations</span></span>

<span data-ttu-id="ea4a8-378">Identitet och säkerhet är viktiga ämnen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-378">Identity and security are important topics.</span></span> <span data-ttu-id="ea4a8-379">Särskilt när lösningen sträcker sig oberoende Azure Stack Hubbs instanser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-379">Especially when the solution spans independent Azure Stack Hub instances.</span></span> <span data-ttu-id="ea4a8-380">Kubernetes och Azure (inklusive Azure Stack Hub) har båda särskilda mekanismer för rollbaserad åtkomst kontroll (RBAC):</span><span class="sxs-lookup"><span data-stu-id="ea4a8-380">Kubernetes and Azure (including Azure Stack Hub) both have distinct mechanisms for role-based access control (RBAC):</span></span>

- <span data-ttu-id="ea4a8-381">Azure RBAC styr åtkomsten till resurser i Azure (och Azure Stack Hub), inklusive möjligheten att skapa nya Azure-resurser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-381">Azure RBAC controls access to resources in Azure (and Azure Stack Hub), including the ability to create new Azure resources.</span></span> <span data-ttu-id="ea4a8-382">Behörigheter kan tilldelas till användare, grupper eller tjänstens huvud namn.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-382">Permissions can be assigned to users, groups, or service principals.</span></span> <span data-ttu-id="ea4a8-383">(Ett huvud namn för tjänsten är en säkerhets identitet som används av program.)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-383">(A service principal is a security identity used by applications.)</span></span>
- <span data-ttu-id="ea4a8-384">Kubernetes RBAC styr behörigheter till Kubernetes-API: et.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-384">Kubernetes RBAC controls permissions to the Kubernetes API.</span></span> <span data-ttu-id="ea4a8-385">Att till exempel skapa poddar och Visa poddar är åtgärder som kan godkännas (eller nekas) till en användare via RBAC.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-385">For example, creating pods and listing pods are actions that can be authorized (or denied) to a user through RBAC.</span></span> <span data-ttu-id="ea4a8-386">För att tilldela Kubernetes behörigheter till användare skapar du roller och roll bindningar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-386">To assign Kubernetes permissions to users, you create roles and role bindings.</span></span>

<span data-ttu-id="ea4a8-387">**Azure Stack hubb identitet och RBAC**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-387">**Azure Stack Hub identity and RBAC**</span></span>

<span data-ttu-id="ea4a8-388">Azure Stack Hub erbjuder två alternativ för identitets leverantörer.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-388">Azure Stack Hub provides two identity provider choices.</span></span> <span data-ttu-id="ea4a8-389">Vilken provider du använder beror på miljön och om den körs i en ansluten eller frånkopplad miljö:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-389">The provider you use depends on the environment and whether running in a connected or disconnected environment:</span></span>

- <span data-ttu-id="ea4a8-390">Azure AD – kan bara användas i en ansluten miljö.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-390">Azure AD - can only be used in a connected environment.</span></span>
- <span data-ttu-id="ea4a8-391">ADFS till en traditionell Active Directory skog – kan användas både i en ansluten eller frånkopplad miljö.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-391">ADFS to a traditional Active Directory forest - can be used in both a connected or disconnected environment.</span></span>

<span data-ttu-id="ea4a8-392">Identitets leverantören hanterar användare och grupper, inklusive autentisering och auktorisering för åtkomst till resurser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-392">The identity provider manages users and groups, including authentication and authorization for accessing resources.</span></span> <span data-ttu-id="ea4a8-393">Åtkomst kan beviljas till Azure Stack hubb resurser som prenumerationer, resurs grupper och enskilda resurser, t. ex. virtuella datorer eller belastningsutjämnare.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-393">Access can be granted to Azure Stack Hub resources like subscriptions, resource groups, and individual resources like VMs or load balancers.</span></span> <span data-ttu-id="ea4a8-394">Om du vill ha en konsekvent åtkomst modell bör du överväga att använda samma grupper (antingen direkt eller kapslat) för alla Azure Stack hubbar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-394">To have a consistent access model, you should consider using the same groups (either direct or nested) for all Azure Stack Hubs.</span></span> <span data-ttu-id="ea4a8-395">Här är ett konfigurations exempel:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-395">Here's a configuration example:</span></span>

![kapslade AAD-grupper med Azure Stack Hub](media/pattern-highly-available-kubernetes/azure-stack-azure-ad-nested-groups.png)

<span data-ttu-id="ea4a8-397">Exemplet innehåller en dedikerad grupp (med AAD eller ADFS) för ett specifikt syfte.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-397">The example contains a dedicated group (using AAD or ADFS) for a specific purpose.</span></span> <span data-ttu-id="ea4a8-398">Om du till exempel vill ge deltagar behörighet för resurs gruppen som innehåller vår Kubernetes-kluster infrastruktur på en speciell Azure Stack Hub-instans (här "Seattle K8s Cluster Contributor").</span><span class="sxs-lookup"><span data-stu-id="ea4a8-398">For example, to provide Contributor permissions for the Resource Group that contains our Kubernetes cluster infrastructure on a specific Azure Stack Hub instance (here "Seattle K8s Cluster Contributor").</span></span> <span data-ttu-id="ea4a8-399">Dessa grupper kapslas sedan in i en övergripande grupp som innehåller "under grupper" för varje Azure Stack hubb.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-399">These groups are then nested into an overall group that contains the "subgroups" for each Azure Stack Hub.</span></span>

<span data-ttu-id="ea4a8-400">Vår exempel användare kommer nu att ha "deltagar"-behörighet för båda resurs grupperna som innehåller hela uppsättningen infrastruktur resurser för Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-400">Our sample user will now have "Contributor" permissions to both Resources Groups that contain the entire set of Kubernetes infrastructure resources.</span></span> <span data-ttu-id="ea4a8-401">Användaren kommer att ha åtkomst till resurser på båda Azure Stack Hubbs instanser, eftersom instanserna delar samma identitets leverantör.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-401">The user will have access to resources on both Azure Stack Hub instances, because the instances share the same identity provider.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ea4a8-402">Dessa behörigheter påverkar endast Azure Stack hubb och några av de resurser som distribueras ovanpå den.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-402">These permissions affect only Azure Stack Hub and some of the resources deployed on top of it.</span></span> <span data-ttu-id="ea4a8-403">En användare som har den här åtkomst nivån kan göra mycket skadlig, men kan inte komma åt Kubernetes IaaS-VM: er eller Kubernetes-API utan ytterligare åtkomst till Kubernetes-distributionen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-403">A user who has this level of access can do a lot of harm, but cannot access the Kubernetes IaaS VMs nor the Kubernetes API without additional access to the Kubernetes deployment.</span></span>

<span data-ttu-id="ea4a8-404">**Kubernetes-identitet och RBAC**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-404">**Kubernetes identity and RBAC**</span></span>

<span data-ttu-id="ea4a8-405">Ett Kubernetes-kluster använder som standard inte samma identitetsprovider som Azure Stack hubben.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-405">A Kubernetes cluster, by default, doesn't use the same Identity Provider as the underlaying Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-406">De virtuella datorerna som är värdar för Kubernetes-klustret, Master-och Worker-noderna använder SSH-nyckeln som anges under distributionen av klustret.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-406">The VMs hosting the Kubernetes cluster, the master, and worker nodes, use the SSH Key that is specified during the deployment of the cluster.</span></span> <span data-ttu-id="ea4a8-407">Den här SSH-nyckeln krävs för att ansluta till de här noderna med SSH.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-407">This SSH key is required to connect to these nodes using SSH.</span></span>

<span data-ttu-id="ea4a8-408">Kubernetes-API (som till exempel nås med hjälp av `kubectl` ) skyddas också av tjänst konton, inklusive ett tjänst konto för standard kluster administratör.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-408">The Kubernetes API (for example, accessed by using `kubectl`) is also protected by service accounts including a default "cluster admin" service account.</span></span> <span data-ttu-id="ea4a8-409">Autentiseringsuppgifterna för det här tjänst kontot lagras initialt i `.kube/config` filen på dina Kubernetes huvud noder.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-409">The credentials for this service account are initially stored in the `.kube/config` file on your Kubernetes master nodes.</span></span>

<span data-ttu-id="ea4a8-410">**Hemligheter för hantering och programautentiseringsuppgifter**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-410">**Secrets management and application credentials**</span></span>

<span data-ttu-id="ea4a8-411">För att lagra hemligheter som anslutnings strängar eller autentiseringsuppgifter finns det flera alternativ, inklusive:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-411">To store secrets like connection strings or database credentials there are several choices, including:</span></span>

- <span data-ttu-id="ea4a8-412">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="ea4a8-412">Azure Key Vault</span></span>
- <span data-ttu-id="ea4a8-413">Kubernetes-hemligheter</span><span class="sxs-lookup"><span data-stu-id="ea4a8-413">Kubernetes Secrets</span></span>
- <span data-ttu-id="ea4a8-414">lösningar från tredje part som HashiCorp Vault (som körs på Kubernetes)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-414">3rd-Party solutions like HashiCorp Vault (running on Kubernetes)</span></span>

<span data-ttu-id="ea4a8-415">Lagra inte hemligheter eller autentiseringsuppgifter i klartext i konfigurationsfiler, program koden eller i skript.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-415">Do not store secrets or credentials in plaintext in your configuration files, application code, or within scripts.</span></span> <span data-ttu-id="ea4a8-416">Och lagra dem inte i ett versions kontroll system.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-416">And do not store them in a version control system.</span></span> <span data-ttu-id="ea4a8-417">I stället bör distributions automatiseringen Hämta hemligheterna vid behov.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-417">Instead, the deployment automation should retrieve the secrets as needed.</span></span>

## <a name="patch-and-update"></a><span data-ttu-id="ea4a8-418">Uppdatering och uppdatering</span><span class="sxs-lookup"><span data-stu-id="ea4a8-418">Patch and update</span></span>

<span data-ttu-id="ea4a8-419">Processen för **korrigering och uppdatering (PNU)** i Azure Kubernetes-tjänsten är delvis automatiserad.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-419">The **Patch and Update (PNU)** process in Azure Kubernetes Service is partially automated.</span></span> <span data-ttu-id="ea4a8-420">Kubernetes versions uppgraderingar utlöses manuellt, medan säkerhets uppdateringar tillämpas automatiskt.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-420">Kubernetes version upgrades are triggered manually, while security updates are applied automatically.</span></span> <span data-ttu-id="ea4a8-421">Dessa uppdateringar kan omfatta säkerhets korrigeringar för operativ system eller kernel-uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-421">These updates can include OS security fixes or kernel updates.</span></span> <span data-ttu-id="ea4a8-422">AKS startar inte om dessa Linux-noder automatiskt för att slutföra uppdaterings processen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-422">AKS doesn't automatically reboot these Linux nodes to complete the update process.</span></span> 

<span data-ttu-id="ea4a8-423">PNU-processen för ett Kubernetes-kluster som distribueras med AKS-motorn på Azure Stack Hub är ohanterad och ansvarar för kluster operatorn.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-423">The PNU process for a Kubernetes cluster deployed using AKS Engine on Azure Stack Hub is unmanaged, and is the responsibility of the cluster operator.</span></span> 

<span data-ttu-id="ea4a8-424">AKS-motorn hjälper till med de två viktigaste uppgifterna:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-424">AKS Engine helps with the two most important tasks:</span></span>

- [<span data-ttu-id="ea4a8-425">Uppgradera till en nyare Kubernetes och bas operativ system avbildnings version</span><span class="sxs-lookup"><span data-stu-id="ea4a8-425">Upgrade to a newer Kubernetes and base OS image version</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-upgrade-to-a-newer-kubernetes-version)
- [<span data-ttu-id="ea4a8-426">Uppgradera endast bas operativ system avbildningen</span><span class="sxs-lookup"><span data-stu-id="ea4a8-426">Upgrade the base OS image only</span></span>](/azure-stack/user/azure-stack-kubernetes-aks-engine-upgrade#steps-to-only-upgrade-the-os-image)

<span data-ttu-id="ea4a8-427">Nyare Base OS-avbildningar innehåller de senaste säkerhets korrigeringarna för operativ systemet och kernel-uppdateringar.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-427">Newer base OS images contain the latest OS security fixes and kernel updates.</span></span> 

<span data-ttu-id="ea4a8-428">Den [obevakade uppgraderings](https://wiki.debian.org/UnattendedUpgrades) mekanismen installerar automatiskt säkerhets uppdateringar som släpps innan en ny bas operativ system avbildnings version är tillgänglig på Azure Stack hubb Marketplace.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-428">The [Unattended Upgrade](https://wiki.debian.org/UnattendedUpgrades) mechanism automatically installs security updates that are released before a new base OS image version is available in the Azure Stack Hub Marketplace.</span></span> <span data-ttu-id="ea4a8-429">Obevakad uppgradering är aktiverat som standard och installerar säkerhets uppdateringar automatiskt, men startar inte om Kubernetes-klusternoderna.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-429">Unattended upgrade is enabled by default and installs security updates automatically, but does not reboot the Kubernetes cluster nodes.</span></span> <span data-ttu-id="ea4a8-430">Att starta om noderna kan automatiseras med hjälp av Aemon med öppen källkod [ **K** Ubernetes reboot **D**(kured)) **RE**](/azure/aks/node-updates-kured).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-430">Rebooting the nodes can be automated using the open-source [**K** Ubernetes **RE** boot **D** aemon (kured))](/azure/aks/node-updates-kured).</span></span> <span data-ttu-id="ea4a8-431">Kured söker efter Linux-noder som kräver en omstart och hanterar sedan automatiskt omschemaläggningen av pågående poddar och omstart av en nod.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-431">Kured watches for Linux nodes that require a reboot, then automatically handle the rescheduling of running pods and node reboot process.</span></span>

## <a name="deployment-cicd-considerations"></a><span data-ttu-id="ea4a8-432">Överväganden för distribution (CI/CD)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-432">Deployment (CI/CD) considerations</span></span>

<span data-ttu-id="ea4a8-433">Azure och Azure Stack Hub exponerar samma Azure Resource Manager REST-API: er.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-433">Azure and Azure Stack Hub expose the same Azure Resource Manager REST APIs.</span></span> <span data-ttu-id="ea4a8-434">Dessa API: er behandlas som andra Azure-moln (Azure, Azure Kina 21Vianet, Azure Government).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-434">These APIs are addressed like any other Azure cloud (Azure, Azure China 21Vianet, Azure Government).</span></span> <span data-ttu-id="ea4a8-435">Det kan finnas skillnader i API-versioner mellan moln och Azure Stack Hub tillhandahåller bara en delmängd av tjänsterna.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-435">There may be differences in API versions between clouds, and Azure Stack Hub provides only a subset of services.</span></span> <span data-ttu-id="ea4a8-436">URI: n för hanterings slut punkter är också olika för varje moln och varje instans av Azure Stack hubben.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-436">The management endpoint URI is also different for each cloud, and each instance of Azure Stack Hub.</span></span>

<span data-ttu-id="ea4a8-437">Förutom de diskreta skillnaderna som anges kan Azure Resource Manager REST-API: er tillhandahålla ett konsekvent sätt att interagera med både Azure och Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-437">Aside from the subtle differences mentioned, Azure Resource Manager REST APIs provide a consistent way to interact with both Azure and Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-438">Samma uppsättning verktyg kan användas här som används med andra Azure-moln.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-438">The same set of tools can be used here as would be used with any other Azure cloud.</span></span> <span data-ttu-id="ea4a8-439">Du kan använda Azure DevOps, verktyg som Jenkins eller PowerShell för att distribuera och dirigera tjänster till Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-439">You can use Azure DevOps, tools like Jenkins, or PowerShell, to deploy and orchestrate services to Azure Stack Hub.</span></span>

<span data-ttu-id="ea4a8-440">**Överväganden**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-440">**Considerations**</span></span>

<span data-ttu-id="ea4a8-441">En av de största skillnaderna när det kommer till Azure Stack hubb distributioner är frågan om Internet-tillgänglighet.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-441">One of the major differences when it comes to Azure Stack Hub deployments is the question of Internet accessibility.</span></span> <span data-ttu-id="ea4a8-442">Internet-hjälpmedel avgör om du vill välja en Microsoft-värdbaserad eller en egen värd versions agent för dina CI/CD-jobb.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-442">Internet accessibility determines whether to select a Microsoft-hosted or a self-hosted build agent for your CI/CD jobs.</span></span>

<span data-ttu-id="ea4a8-443">En lokal agent kan köras ovanpå Azure Stack Hub (som en IaaS VM) eller i ett undernät för nätverk som har åtkomst till Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-443">A self-hosted agent can run on top of Azure Stack Hub (as an IaaS VM) or in a network subnet that can access Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-444">Gå till [Azure pipelines-agenter](/azure/devops/pipelines/agents/agents) om du vill veta mer om skillnaderna.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-444">Go to [Azure Pipelines agents](/azure/devops/pipelines/agents/agents) to learn more about the differences.</span></span>

<span data-ttu-id="ea4a8-445">Följande bild hjälper dig att bestämma om du behöver en egen värd eller en Microsoft-värdbaserad build-agent:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-445">The following image helps you to decide if you need a self-hosted or a Microsoft-hosted build agent:</span></span>

![Egna värdbaserade Bygg agenter Ja eller Nej](media/pattern-highly-available-kubernetes/aks-on-stack-self-hosted-build-agents-yes-or-no.png)

- <span data-ttu-id="ea4a8-447">Är slut punkterna för hantering av Azure Stack Hub tillgängliga via Internet?</span><span class="sxs-lookup"><span data-stu-id="ea4a8-447">Are the Azure Stack Hub management endpoints accessible via Internet?</span></span>
  - <span data-ttu-id="ea4a8-448">Ja: vi kan använda Azure-pipelines med Microsofts värdbaserade agenter för att ansluta till Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-448">Yes: We can use Azure Pipelines with Microsoft-hosted agents to connect to Azure Stack Hub.</span></span>
  - <span data-ttu-id="ea4a8-449">Nej: vi behöver egen värdbaserade agenter som kan ansluta till Azure Stack hubbens hanterings slut punkter.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-449">No: We need self-hosted agents that can connect to Azure Stack Hub's management endpoints.</span></span>
- <span data-ttu-id="ea4a8-450">Är vårt Kubernetes-kluster tillgängligt via Internet?</span><span class="sxs-lookup"><span data-stu-id="ea4a8-450">Is our Kubernetes cluster accessible via the Internet?</span></span>
  - <span data-ttu-id="ea4a8-451">Ja: vi kan använda Azure-pipelines med Microsofts värdbaserade agenter för att interagera direkt med Kubernetes API-slutpunkten.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-451">Yes: We can use Azure Pipelines with Microsoft-hosted agents to interact directly with Kubernetes API endpoint.</span></span>
  - <span data-ttu-id="ea4a8-452">Nej: vi behöver egna värdbaserade agenter som kan ansluta till Kubernetes-klustrets API-slutpunkt.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-452">No: We need self-hosted Agents that can connect to the Kubernetes cluster API endpoint.</span></span>

<span data-ttu-id="ea4a8-453">I scenarier där slut punkterna för Azure Stack Hub-hantering och Kubernetes-API är tillgängliga via Internet kan distributionen använda en Microsoft-värdbaserad agent.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-453">In scenarios where the Azure Stack Hub management endpoints and Kubernetes API are accessible via the internet, the deployment can use a Microsoft-hosted agent.</span></span> <span data-ttu-id="ea4a8-454">Den här distributionen leder till en program arkitektur på följande sätt:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-454">This deployment will result in an application architecture as follows:</span></span>

<span data-ttu-id="ea4a8-455">[![Översikt över offentlig arkitektur](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-455">[![Public architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern.png#lightbox)</span></span>

<span data-ttu-id="ea4a8-456">Om Azure Resource Manager-slutpunkter, Kubernetes-API: n eller båda inte är direkt tillgängliga via Internet, kan vi utnyttja en egen värd versions agent för att köra pipeline-stegen.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-456">If the Azure Resource Manager endpoints, Kubernetes API, or both aren't directly accessible via the Internet, we can leverage a self-hosted build agent to run the pipeline steps.</span></span> <span data-ttu-id="ea4a8-457">Den här designen kräver mindre anslutnings barhet och kan distribueras med endast lokal nätverks anslutning till Azure Resource Manager slut punkter och Kubernetes-API: et:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-457">This design needs less connectivity, and can be deployed with only on-premises network connectivity to Azure Resource Manager endpoints and the Kubernetes API:</span></span>

<span data-ttu-id="ea4a8-458">[![Översikt över lokal-arkitekturen](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span><span class="sxs-lookup"><span data-stu-id="ea4a8-458">[![On-prem architecture overview](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png)](media/pattern-highly-available-kubernetes/aks-azure-stack-app-pattern-self-hosted.png#lightbox)</span></span>

> [!NOTE]
> <span data-ttu-id="ea4a8-459">**Vad gäller frånkopplade scenarier?**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-459">**What about disconnected scenarios?**</span></span> <span data-ttu-id="ea4a8-460">I scenarier där antingen Azure Stack hubb eller Kubernetes eller båda av dem inte har Internet-riktade hanterings slut punkter, är det fortfarande möjligt att använda Azure DevOps för dina distributioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-460">In scenarios where either Azure Stack Hub or Kubernetes or both of them do not have internet-facing management endpoints, it is still possible to use Azure DevOps for your deployments.</span></span> <span data-ttu-id="ea4a8-461">Du kan antingen använda en lokal programmediepool (som är en DevOps-agent som körs lokalt eller på själva Azure Stack hubben) eller en helt egen värd Azure DevOps Server lokalt.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-461">You can either use a self-hosted Agent Pool (which is a DevOps Agent running on-premises or on Azure Stack Hub itself) or a completly self-hosted Azure DevOps Server on-premises.</span></span> <span data-ttu-id="ea4a8-462">Den egen värdbaserade agenten behöver bara utgående HTTPS (TCP/443) Internet anslutning.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-462">The self-hosted agent needs only outbound HTTPS (TCP/443) Internet connectivity.</span></span>

<span data-ttu-id="ea4a8-463">Mönstret kan använda ett Kubernetes-kluster (distribuerat och dirigerat med AKS-motorn) på varje Azure Stack Hub-instans.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-463">The pattern can use a Kubernetes cluster (deployed and orchestrated with AKS engine) on each Azure Stack Hub instance.</span></span> <span data-ttu-id="ea4a8-464">Den innehåller ett program som består av en klient del, en mellan nivå, backend-tjänster (till exempel MongoDB) och en nginx-baserad ingångs kontroll.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-464">It includes an application consisting of a frontend, a mid-tier, backend services (for example MongoDB), and an nginx-based Ingress Controller.</span></span> <span data-ttu-id="ea4a8-465">I stället för att använda en databas som finns i K8s-klustret kan du utnyttja "externa data lager".</span><span class="sxs-lookup"><span data-stu-id="ea4a8-465">Instead of using a database hosted on the K8s cluster, you can leverage "external data stores".</span></span> <span data-ttu-id="ea4a8-466">Databas alternativ inkluderar MySQL, SQL Server eller någon typ av databas som finns utanför Azure Stack Hub eller i IaaS.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-466">Database options include MySQL, SQL Server, or any kind of database hosted outside of Azure Stack Hub or in IaaS.</span></span> <span data-ttu-id="ea4a8-467">Konfigurationer som detta omfattas inte här.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-467">Configurations like this aren't in scope here.</span></span>

## <a name="partner-solutions"></a><span data-ttu-id="ea4a8-468">Partnerlösningar</span><span class="sxs-lookup"><span data-stu-id="ea4a8-468">Partner solutions</span></span>

<span data-ttu-id="ea4a8-469">Det finns Microsofts partner lösningar som kan utöka funktionerna i Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-469">There are Microsoft Partner solutions that can extend the capabilities of Azure Stack Hub.</span></span> <span data-ttu-id="ea4a8-470">Dessa lösningar har hittats användbara vid distribution av program som körs på Kubernetes-kluster.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-470">These solutions have been found useful in deployments of applications running on Kubernetes clusters.</span></span>  

## <a name="storage-and-data-solutions"></a><span data-ttu-id="ea4a8-471">Lagrings-och data lösningar</span><span class="sxs-lookup"><span data-stu-id="ea4a8-471">Storage and data solutions</span></span>

<span data-ttu-id="ea4a8-472">Som det beskrivs i [data-och lagrings överväganden](#data-and-storage-considerations)har Azure Stack Hub för närvarande ingen inbyggd lösning för att replikera lagring över flera instanser.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-472">As described in [Data and storage considerations](#data-and-storage-considerations), Azure Stack Hub currently doesn't have a native solution to replicate storage across multiple instances.</span></span> <span data-ttu-id="ea4a8-473">Till skillnad från Azure finns inte möjligheten att replikera lagring över flera regioner.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-473">Unlike Azure, the capability of replicating storage across multiple regions does not exist.</span></span> <span data-ttu-id="ea4a8-474">I Azure Stack Hub, är varje instans ett eget distinkt moln.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-474">In Azure Stack Hub, each instance is its own distinct cloud.</span></span> <span data-ttu-id="ea4a8-475">Lösningar är dock tillgängliga från Microsoft-partner som aktiverar lagrings replikering i Azure Stack hubbar och Azure.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-475">However, solutions are available from Microsoft Partners that enable storage replication across Azure Stack Hubs and Azure.</span></span> 

<span data-ttu-id="ea4a8-476">**SCALITY**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-476">**SCALITY**</span></span>

<span data-ttu-id="ea4a8-477">[Scality](https://www.scality.com/) levererar lagring av webb skala som har Powered digital verksamhet sedan 2009.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-477">[Scality](https://www.scality.com/) delivers web-scale storage that has powered digital businesses since 2009.</span></span> <span data-ttu-id="ea4a8-478">Scality-ringen, vår programdefinierad lagring, vänder sig till x86-servrar i en obegränsad lagringspool för alla typer av data – fil och objekt – vid petabyte skalning.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-478">The Scality RING, our software-defined storage, turns commodity x86 servers into an unlimited storage pool for any type of data –file and object– at petabyte scale.</span></span>

<span data-ttu-id="ea4a8-479">**CLOUDIAN**</span><span class="sxs-lookup"><span data-stu-id="ea4a8-479">**CLOUDIAN**</span></span>

<span data-ttu-id="ea4a8-480">[Cloudian](https://www.cloudian.com/) fören klar företags lagringen med obegränsad skalbar lagring som konsoliderar enorma data uppsättningar till en enda, lätt hanterad miljö.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-480">[Cloudian](https://www.cloudian.com/) simplifies enterprise storage with limitless scalable storage that consolidates massive data sets to a single, easily managed environment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ea4a8-481">Nästa steg</span><span class="sxs-lookup"><span data-stu-id="ea4a8-481">Next steps</span></span>

<span data-ttu-id="ea4a8-482">Mer information om begrepp som introduceras i den här artikeln:</span><span class="sxs-lookup"><span data-stu-id="ea4a8-482">To learn more about concepts introduced in this article:</span></span>

- <span data-ttu-id="ea4a8-483">Mönster för [skalning mellan moln](pattern-cross-cloud-scale.md) och [geo-distribuerade appar](pattern-geo-distributed.md) i Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-483">[Cross-cloud scaling](pattern-cross-cloud-scale.md) and [Geo-distributed app patterns](pattern-geo-distributed.md) in Azure Stack Hub.</span></span>
- <span data-ttu-id="ea4a8-484">[Mikrotjänsters arkitektur på Azure Kubernetes service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-484">[Microservices architecture on Azure Kubernetes Service (AKS)](/azure/architecture/reference-architectures/microservices/aks).</span></span>

<span data-ttu-id="ea4a8-485">När du är redo att testa lösnings exemplet fortsätter du med [distributions guiden för Kubernetes-kluster med hög tillgänglighet](solution-deployment-guide-highly-available-kubernetes.md).</span><span class="sxs-lookup"><span data-stu-id="ea4a8-485">When you're ready to test the solution example, continue with the [High availability Kubernetes cluster deployment guide](solution-deployment-guide-highly-available-kubernetes.md).</span></span> <span data-ttu-id="ea4a8-486">Distributions guiden innehåller steg-för-steg-instruktioner för att distribuera och testa dess komponenter.</span><span class="sxs-lookup"><span data-stu-id="ea4a8-486">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>